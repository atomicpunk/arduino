#include <stdio.h>
#define REVERSE 1
#define FORWARD 0

const unsigned int pattern_dualbounce[][10]={
  { 0x0ff,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x000,0x0ff },
  { 0x044,0x0ff,0x000,0x000,0x000,0x000,0x000,0x000,0x0ff,0x044 },
  { 0x011,0x044,0x0ff,0x000,0x000,0x000,0x000,0x0ff,0x044,0x011 },
  { 0x000,0x011,0x044,0x0ff,0x000,0x000,0x0ff,0x044,0x011,0x000 },
  { 0x000,0x000,0x011,0x044,0x0ff,0x0ff,0x044,0x011,0x000,0x000 },
  { 0x000,0x000,0x011,0x044,0x0ff,0x0ff,0x044,0x011,0x000,0x000 },
  { 0x000,0x000,0x000,0x0ff,0x044,0x044,0x0ff,0x000,0x000,0x000 },
  { 0x000,0x000,0x0ff,0x044,0x011,0x011,0x044,0x0ff,0x000,0x000 },
  { 0x000,0x0ff,0x044,0x011,0x000,0x000,0x011,0x044,0x0ff,0x000 },
  { 0x0ff,0x044,0x011,0x000,0x000,0x000,0x000,0x011,0x044,0x0ff },
};

const unsigned int pattern_stream[][10]={
  { 0x0ff,0x1df,0x09f,0x15f,0x01f,0x107,0x01f,0x15f,0x09f,0x1df },
  { 0x1df,0x0ff,0x1df,0x09f,0x15f,0x01f,0x107,0x01f,0x15f,0x09f },
  { 0x09f,0x1df,0x0ff,0x1df,0x09f,0x15f,0x01f,0x107,0x01f,0x15f },
  { 0x15f,0x09f,0x1df,0x0ff,0x1df,0x09f,0x15f,0x01f,0x107,0x01f },
  { 0x01f,0x15f,0x09f,0x1df,0x0ff,0x1df,0x09f,0x15f,0x01f,0x107 },
  { 0x107,0x01f,0x15f,0x09f,0x1df,0x0ff,0x1df,0x09f,0x15f,0x01f },
  { 0x01f,0x107,0x01f,0x15f,0x09f,0x1df,0x0ff,0x1df,0x09f,0x15f },
  { 0x15f,0x01f,0x107,0x01f,0x15f,0x09f,0x1df,0x0ff,0x1df,0x09f },
  { 0x09f,0x15f,0x01f,0x107,0x01f,0x15f,0x09f,0x1df,0x0ff,0x1df },
  { 0x1df,0x09f,0x15f,0x01f,0x107,0x01f,0x15f,0x09f,0x1df,0x0ff },
};

void colorize(const unsigned int pattern[][10], int size,
	unsigned int color[], int numcolors, int reverse)
{
	int i, j, cidx;
	int start = (reverse)?(size-1):0;
	int end = (reverse)?(-1):size;
	int inc = (reverse)?(-1):1;
	unsigned int data, c, p;

	for(i = start; i != end; i += inc) {
		cidx = 0;
		printf("  { ");
		for(j = 0; j < 10; j++) {
			p = pattern[i][j] & 0xff;
			cidx = ((pattern[i][j] >> 8) & 0xff) % numcolors;
			c = color[cidx];
			data = ((p * ((c >> 16) & 0xff) / 0xff) << 16) |
			       ((p * ((c >> 8) & 0xff) / 0xff) << 8) |
			        (p * (c & 0xff) / 0xff);
			printf("0x%06x", data);
			if(j < 9) printf(",");
		}
		printf(" },\n");
	}
}

int main(int argc, char *argv[])
{
	unsigned int color[2] = {0, 0};
	int direction = FORWARD;
	int numcolors = 1;
	if(argc < 4) {
		fprintf(stderr, "USAGE: pattern <name> <forward/reverse> <color>\n");
		return -1;
	}
	if(strcmp(argv[2], "reverse") == 0) {
		direction = REVERSE;
	}
	if(sscanf(argv[3], "0x%x", &color[0]) != 1) {
		fprintf(stderr, "What the hell is this: %s?\n", argv[3]);
		return -1;
	}
	if(argc > 4) {
		if(sscanf(argv[4], "0x%x", &color[1]) != 1) {
			fprintf(stderr, "What the hell is this: %s?\n", argv[4]);
			return -1;
		}
		numcolors = 2;
	}
	if(strcmp(argv[1], "dualbounce") == 0) {
		colorize(pattern_dualbounce, 10, color, numcolors, direction);
	} else if(strcmp(argv[1], "stream") == 0) {
		colorize(pattern_stream, 10, color, numcolors, direction);
	}
	return 0;
}
